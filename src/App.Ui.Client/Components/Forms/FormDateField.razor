@using System.Linq.Expressions

<FormField TValue="DateOnly" Id="@ResolvedId" Label="@Label" HelpText="@HelpText" ValueExpression="ValueExpression">
    <InputDate
        TValue="DateOnly"
        id="@ResolvedId"
        class="w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-slate-400 focus:outline-none focus:ring-2 focus:ring-slate-200"
        @bind-Value="CurrentValue"
        @bind-Value:event="@(UpdateOnInput ? "oninput" : "onchange")"
        @attributes="InputAttributes" />
</FormField>

@code {
    [Parameter] public string Id { get; set; } = string.Empty;
    [Parameter] public string Label { get; set; } = string.Empty;
    [Parameter] public string? HelpText { get; set; }
    [Parameter] public DateOnly Value { get; set; }
    [Parameter] public EventCallback<DateOnly> ValueChanged { get; set; }
    [Parameter] public Expression<Func<DateOnly>>? ValueExpression { get; set; }
    [Parameter] public bool UpdateOnInput { get; set; }
    [Parameter] public Dictionary<string, object>? InputAttributes { get; set; }

    private readonly string _componentId = Guid.NewGuid().ToString("N")[..8];

    private string ResolvedId => FormFieldIdResolver.Resolve(Id, ValueExpression, _componentId);

    private DateOnly CurrentValue
    {
        get => Value;
        set
        {
            if (Value == value)
            {
                return;
            }

            Value = value;
            _ = ValueChanged.InvokeAsync(value);
        }
    }

}
